<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lunaverse Adventure</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }
        
        #game-stage {
            width: 100vw;
            height: 100vh;
            background: url('lunaverse_wallpaper.PNG') no-repeat center center;
            background-size: cover;
            position: relative;
        }

        .sprite { position: absolute; pointer-events: none; transition: transform 0.2s; }
        
        /* Animation for zooming East */
        @keyframes walkEast {
            from { left: -250px; }
            to { left: 110vw; }
        }
        .zoom-east { animation: walkEast 4s linear forwards; }
    </style>
</head>
<body>

<div id="game-stage">
    <img id="grandma" src="preserved_lemon .png" style="display:none; position:absolute; bottom:0; left:0; width:200px; z-index:10;">
</div>

<script>
const stage = document.getElementById('game-stage');
const grandma = document.getElementById('grandma');

// 1. GLOBAL AUDIO PLAYER (To prevent overlapping)
let currentAudio = null;

function playSound(file) {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0; // Reset to start
    }
    currentAudio = new Audio(file);
    currentAudio.play();
}

// 2. STAR TRAIL LOGIC
function createStar(x, y) {
    const star = document.createElement('div');
    star.innerHTML = 'âœ¨'; // Matching your wallpaper stars
    star.style.position = 'absolute';
    star.style.left = x + 'px';
    star.style.top = y + 'px';
    star.style.fontSize = '20px';
    star.style.pointerEvents = 'none';
    star.style.transition = 'all 0.8s ease-out';
    stage.appendChild(star);

    // Make it float up and fade
    setTimeout(() => {
        star.style.transform = 'translateY(-50px) scale(0)';
        star.style.opacity = '0';
    }, 10);
    setTimeout(() => star.remove(), 800);
}

// 3. MAIN INTERACTION
stage.addEventListener('click', (e) => {
    // Sparkle trail at touch point
    createStar(e.clientX, e.clientY);

    const randomChance = Math.random();

    // A. 10% Chance Grandma appears with lemons
    if (randomChance < 0.1) {
        grandma.style.display = 'block';
        setTimeout(() => { grandma.style.display = 'none'; }, 3000);
    }

    // B. Play Random Audio (Managed)
    const stationarySounds = ['Luna-moon-Stella-star.mp3', 'luna_whisper.mp3'];
    playSound(stationarySounds[Math.floor(Math.random() * stationarySounds.length)]);

    // C. Sprite Logic
    if (randomChance > 0.7) {
        // Zoomer Logic for East-facing sprites
        const eastBound = ['blue_azul_front.png', 'cardboard_tank.png', 'mochkil_walk_right_cake.png'];
        const zoomer = document.createElement('img');
        zoomer.src = eastBound[Math.floor(Math.random() * eastBound.length)];
        zoomer.className = 'sprite zoom-east'; // Uses the CSS animation from before
        zoomer.style.top = Math.random() * 60 + 10 + '%';
        zoomer.style.width = '180px';
        stage.appendChild(zoomer);
        setTimeout(() => zoomer.remove(), 4500);
    } else {
        // Popper Logic for Stationary sprites
        const poppers = ['Stella.png', 'elina_stella.png', 'friend1.png', 'luna_kitty.png', 'luna_unicorn.png', 'stella_star.png'];
        const img = document.createElement('img');
        img.src = poppers[Math.floor(Math.random() * poppers.length)];
        img.className = 'sprite';
        img.style.left = (e.clientX - 75) + 'px';
        img.style.top = (e.clientY - 75) + 'px';
        img.style.width = '150px';
        stage.appendChild(img);
        setTimeout(() => img.remove(), 2000);
    }
});

</script>

</body>
</html>
